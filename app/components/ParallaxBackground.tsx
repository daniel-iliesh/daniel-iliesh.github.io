'use client';

import { motion, useScroll, useTransform } from "motion/react";

// Extracted simplified paths from bg_snow.svg for crisp, layered parallax.
// Colors are controlled via CSS variables for quick tweaking.
const PATH_FAR =
  "M0,416h16l16,32l47.1,33.6c0,0,19.5,0,25.5,0s-3-6,21-4.5s34.5,3,39,4.5c4.5,1.5,15-4.5,22.5-4.5c7.5,0,7.3,0,14.9-4.5c7.6-4.5,19.6-3,37.6-4.5c18-1.5,25.5,3,31.5,0s21-22.5,25.5-25.5c4.5-3,22.5-13.5,22.5-13.5s-6-3,13.5,0c19.5,3,21-13.2,25.5-1.3c4.5,11.8-4.5,15.3,0,24.8c4.5,9.5,0,3.5,4.5,9.5c4.5,6,1.5,3,16.5,6c15,3,15.6-2.1,27,3s9,3.5,15,10.7c6,7.3,3,8.8,19.5,14.8s27,7.5,36,7.5c9,0,19.5-1.5,36,0c16.5,1.5,19.5,3,36,0c16.5-3,15-6,36-6c21,0,19.5,8,45,7.7c25.5-0.2,106.5-15.2,120-21.2s12-19,18-20c6-1,13.1-11.5,21-13c7.9-1.5,16.5,4.5,30,4.5s10.5,9.5,22.5,8.5c12-1,13.5-2,22.5,0c9,2,13.5,8,22.5,11c9,3,9,4.5,15,6c6,1.5,18-4.5,18-4.5l12-12.5c0,0-6-19,7.5-20.5c13.5-1.5-4.5-1.5,13.5-1.5c18,0,18-1.5,28.5,0c10.5,1.5,11-1.7,16.5,12c5.5,13.7-1.5,22.5,7.5,28.5c9,6,21,1.5,37.5,9c16.5,7.5-9-7.5,16.5,7.5c25.5,15,27,16.5,46.5,16.5s24,4.5,37.5,0c13.5-4.5,19.5-19.5,19.5-25.5s-13.5-8.2,0-19.9c13.5-11.6,15-13.1,28.5-17.6c13.5-4.5,18-12,27-13.5c9-1.5,16.5-3.9,18-16.2c1.5-12.3-2.1-15.4,10.5-25.8c29.2-24.2,33.9,18.4,33.9,18.4v304H0V416z";

const PATH_MID =
  "M0,528c5.6-2.1,11.2-0.4,14.6-3.8c9-8.9,16.5-11.9,19.5-17.9s13.5-19.5,13.5-19.5s-3-15,0-21c3-6,0-45,0-45s-21-4.5,7.5-12s37.5-13.5,52.5-13.5s22.5,7.5,46.5,0s51-7.5,51-7.5s16.5,15,18,27s-7.5,21,0,33c7.5,12,7.5-3,16.5,18c9,21,6,25.5,21,27c15,1.5,18,3,28.5,3s21-7.5,30,6c9,13.5,10.5,23.7,24,22.4s21-4.6,30,0s18,16.6,22.5,6.1c4.5-10.5,3-36,12-43.5c9-7.5,18-34.5,37.5-29.2c19.5,5.2,10.5-0.8,28.5,6.7c18,7.5,21,10.5,31.5,9c10.5-1.5,16.5-19.5,27-15.7c10.5,3.7,12-2.3,28.5,6.7c16.5,9,13.5,16.5,34.5,12c21-4.5,27-9,36-10.5c9-1.5,19.5-7.5,25.5-8.2c6-0.8,6,0.7,6-11.3c0-12-13.5-51,16.5-51c30,0,37.5-3,55.5,0c18,3,24-12,31.5,6c7.5,18,0,10.5,9,24c9,13.5,0,22.5,13.5,24c13.5,1.5,15-15,31.5-16.5c16.5-1.5,30-16.5,39-19.5c9-3,21,31.5,13.5,51c-7.5,19.5-31.5,12-24,25.5s4.5,10.5,22.5,16.5c18,6,22.5-4.5,33,6c10.5,10.5-13.5,67.2,19.5,11.9s34.5-59.6,49.5-61.2c15-1.6,4.5-5.9,21,0c16.5,5.9,18,7.4,30,7.4c12,0,18,0,27,0c9,0,16.5,0,21,0s13.5-16.5,15,3c1.5,19.5-6,31.5,6,30s15-3,31.5-4.5c16.5-1.5,13.4-84.3,43.4-82.8s15.5,16,32,16s32,16,32,16l32,80l16,16v176H0";

const PATH_NEAR =
  "M0,576l30.3,4.6h12c0,0,4.5,4.5,9,0c4.5-4.5,6-3,12,0c6,3,9-6.5,15,2c6,8.5,13.6,8.5,15.8,11.5c2.2,3,11.2,10.5,11.2,10.5s5.9-2.3,12,0c6.1,2.3-7.3,3.3,6.1,2.3s17.1,0.2,23.9,0.1s13.5,7.5,22.5,3.3c9-4.2,19.5,5.7,31.5,0c12-5.7,6,5.7,19.5,0c13.5-5.7,7.5,1.8,24-7.2c16.5-9,22.5-15,31.5-18c9-3,6.8-10.4,19.5-9.2c12.7,1.3-6.5-3.6,35.7-7.7s42.3,4.1,54.3,0s30,1.8,36-1.2c6-2.9,18-7.4,28.5-8.9c10.5-1.5,16.5,6,27,0s15-1.9,33-0.2c18,1.7,21,6.2,31.5,6.2c10.5,0,10.5-4.5,24,0c13.5,4.5,15,6,25.5,9c10.5,3,9.5,7.4,18.2,10.4c8.8,3.1,2.8,0.1,19.3,9.1c16.5,9,21,10.5,43.5,9c22.5-1.5,15-1.5,39-1.5c24,0,36,1.5,49.5,1.5s25.5,1.5,45-6s36-18,48-19.5s21-1.5,34.5-1.5c13.5,0-7.5,19.5,25.5-6s28.5-34.5,40.5-36c12-1.5,15,0,28.5,0s7.5-13.3,21-0.7c13.5,12.7-3,3.7,25.5,18.7c28.5,15,31.5,2.9,39,18.7c7.5,15.8,8.8,16.7,16.4,19.2s18.1-6.4,36.1-6.4s10.5-8.8,24-12.8c13.5-4,27,6.8,36,6.8c9,0,12-3,27,1.5c15,4.5,27,4.5,37.5,4.5s25.5,1.5,25.5,1.5l9.3-7.6v144H0V576z";

type LayerConfig = {
  path: string;
  colorVar: string;
  opacity?: number;
  factor: number;
  viewBox?: string;
  className?: string;
};

const LAYERS: LayerConfig[] = [
  {
    path: PATH_FAR,
    colorVar: "--parallax-far",
    factor: -0.05,
    viewBox: "0 0 1280 720",
    className: "bg-far",
  },
  {
    path: PATH_MID,
    colorVar: "--parallax-mid",
    factor: -0.18,
    viewBox: "0 0 1280 720",
    className: "bg-mid",
  },
  {
    path: PATH_MID,
    colorVar: "--parallax-mid2",
    factor: -0.26,
    opacity: 0.9,
    viewBox: "0 0 1280 720",
    className: "bg-mid",
  },
  {
    path: PATH_NEAR,
    colorVar: "--parallax-near",
    factor: -0.38,
    viewBox: "0 0 1280 720",
    className: "bg-near",
  },
];

export function ParallaxBackground() {
  const { scrollY } = useScroll();

  return (
    <div className="parallax-bg" aria-hidden="true">
      <div className="parallax-bg__base" />
      {LAYERS.map((layer, idx) => {
        const y = useTransform(scrollY, (v) => v * layer.factor);
        return (
          <motion.svg
            key={idx}
            className={layer.className}
            viewBox={layer.viewBox ?? "0 0 1280 720"}
            preserveAspectRatio="xMidYMid slice"
            style={{ y }}
          >
            <path
              d={layer.path}
              fill={`var(${layer.colorVar})`}
              opacity={layer.opacity ?? 1}
            />
          </motion.svg>
        );
      })}
    </div>
  );
}
